<%- include('../partials/header') %>
<div class="row">
    <div class="col-12 mb-4">
        <h1>Admin Dashboard</h1>
        <p>Welkom, <%= user.username %>!</p>
    </div>

    <!-- Row 1: Website Management (Blue) -->
    <div class="col-12 mb-3">
        <h3>Website Beheer</h3>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <h3 class="card-title"><i class="bi bi-calendar-event"></i></h3>
                <p>Beheer de kalender en evenementen.</p>
                <a href="/admin/events" class="btn btn-primary w-100">Kalender</a>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <h3 class="card-title"><i class="bi bi-person-badge"></i></h3>
                <p>Voeg leiding info toe voor de 'Leiding' pagina.</p>
                <a href="/admin/leaders" class="btn btn-primary w-100">Leiding Info</a>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <h3 class="card-title"><i class="bi bi-images"></i></h3>
                <p>Upload afbeeldingen voor gebruik op pagina's.</p>
                <a href="/admin/uploads" class="btn btn-primary w-100">Bestanden & Foto's</a>
            </div>
        </div>
    </div>

    <!-- Row 2: Admin Tools (Green) -->
    <div class="col-12 mb-3 mt-2">
        <h3>Administratie</h3>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card h-100 border-success">
            <div class="card-body text-center text-success">
                <h3 class="card-title"><i class="bi bi-people-fill"></i></h3>
                <p>Beheer accounts voor leiding en admins.</p>
                <a href="/admin/users" class="btn btn-success w-100">Gebruikers Beheren</a>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card h-100 border-success">
            <div class="card-body text-center text-success">
                <h3 class="card-title"><i class="bi bi-collection-fill"></i></h3>
                <p>Beheer groepen voor het leidingshoekje.</p>
                <a href="/admin/feedgroups" class="btn btn-success w-100">Leidingshoekjes</a>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card h-100 border-success">
            <div class="card-body text-center text-success">
                <h3 class="card-title"><i class="bi bi-clipboard-data"></i></h3>
                <p>Bekijk wie zich heeft ingeschreven en exporteer.</p>
                <a href="/admin/registrations" class="btn btn-success w-100">Inschrijvingen</a>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card h-100 border-success">
            <div class="card-body text-center text-success">
                <h3 class="card-title"><i class="bi bi-piggy-bank"></i></h3>
                <p>Financieel beheer en transacties.</p>
                <a href="/admin/finance" class="btn btn-success w-100">Financiën</a>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card h-100 border-success">
            <div class="card-body text-center text-success">
                <h3 class="card-title"><i class="bi bi-envelope-fill"></i></h3>
                <p>Stuur emails naar leiding, leden of ouders.</p>
                <a href="/admin/email" class="btn btn-success w-100">Email Tool</a>
            </div>
        </div>
    </div>

    <!-- Help & Pages -->
    <div class="col-md-12 mb-4">
        <div class="alert alert-info d-flex align-items-center">
            <i class="bi bi-info-circle-fill fs-4 me-3"></i>
            <div>
                <strong>Hulp nodig?</strong>
                <br>
                Bekijk de <a href="/admin/info" class="alert-link">documentatie</a> om te leren hoe je de site aanpast.
            </div>
        </div>
    </div>

    <div class="col-md-12 mt-4">
        <h3>Pagina's Bewerken</h3>
        <div class="list-group">
            <a href="/admin/page/home" class="list-group-item list-group-item-action">Home</a>
            <a href="/admin/page/practical" class="list-group-item list-group-item-action">Praktisch</a>
            <a href="/admin/page/departments" class="list-group-item list-group-item-action">Afdelingen</a>
            <a href="/admin/page/shirts" class="list-group-item list-group-item-action">T-Shirts</a>
            <a href="/admin/page/register" class="list-group-item list-group-item-action">Inschrijven (Info tekst)</a>
        </div>
    </div>

    <div class="col-md-12 mt-5">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h3 class="mb-0"><i class="bi bi-exclamation-triangle-fill me-2"></i>Danger Zone</h3>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <form action="/admin/danger/backup" method="POST">
                            <button type="submit" class="btn btn-outline-dark w-100 p-3">
                                <i class="bi bi-hdd-fill fs-4 d-block mb-2"></i>
                                Maak Backup
                            </button>
                        </form>
                        <small class="text-muted d-block text-center mt-2">Maakt een volledige backup van database en foto's.</small>
                    </div>
                    <div class="col-md-6">
                        <button type="button" class="btn btn-danger w-100 p-3" data-bs-toggle="modal" data-bs-target="#resetWebsiteModal">
                            <i class="bi bi-radioactive fs-4 d-block mb-2"></i>
                            Reset Website
                        </button>
                        <small class="text-muted d-block text-center mt-2">Wist alles (Events, Leiding, Inschrijvingen, Teksten) behalve accounts & bestanden.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Reset Website Modal -->
<div class="modal fade" id="resetWebsiteModal" tabindex="-1" aria-labelledby="resetWebsiteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content border-danger">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="resetWebsiteModalLabel">⚠️ Website Resetten</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form action="/admin/danger/reset-website" method="POST">
          <div class="modal-body">
            <p class="fw-bold">Weet je het zeker?</p>
            <p>Hiermee verwijder je <strong>ALLE</strong> dynamische data uit de database:</p>
            <ul>
                <li>Alle leden/leiding in de database</li>
                <li>Alle kalender items</li>
                <li>Alle inschrijvingen</li>
                <li>Alle teksten van pagina's (Home, Praktisch, etc.)</li>
                <li><strong>Alle geüploade foto's en bestanden</strong></li>
            </ul>
            <p>Alleen jouw beheerdersaccount blijft bestaan.</p>
            
            <div class="mb-3">
                <label for="password" class="form-label">Bevestig met je wachtwoord:</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuleren</button>
            <button type="submit" class="btn btn-danger">Ja, Reset Alles</button>
          </div>
      </form>
    </div>
  </div>
</div>

<% if (typeof success !== 'undefined' && success) { %>
    <script>
        // Simple toast or alert logic if needed via query params, but server renders it usually in header or dashboard top.
        // Wait, I see 'dashboard.ejs' doesn't handle success/error messages explicitly in the code I read before?
        // Let me check 'views/partials/header.ejs' or if dashboard handles it.
    </script>
<% } %>

<div class="mt-3">
    <% if (typeof query !== 'undefined' && query.success) { %>
        <div class="alert alert-success"><%= query.success %></div>
    <% } %>
    <% if (typeof query !== 'undefined' && query.error) { %>
        <div class="alert alert-danger"><%= query.error %></div>
    <% } %>
</div>
<!-- Note: Since I redirect with query params, I need to parse them. 
     Usually express doesn't pass query to view automatically unless I do `res.locals.query = req.query` in middleware.
     But I see `res.render` calls passing specific objects.
     
     Let's check server.js middleware:
     `app.use((req, res, next) => { res.locals.user = req.user || null; next(); });`
     It doesn't pass query.
     
     I will add a script to read URL params for alerts, OR I should change my controller redirects to render with message.
     But redirects are cleaner (Post/Redirect/Get pattern).
     
     Let's add a small JS snippet to show alerts from URL params.
-->
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const successMsg = urlParams.get('success');
    const errorMsg = urlParams.get('error');
    
    if (successMsg) {
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-success fixed-top m-3';
        alertDiv.style.zIndex = '2000';
        alertDiv.innerText = successMsg;
        document.body.prepend(alertDiv);
        setTimeout(() => alertDiv.remove(), 5000);
    }
    
    if (errorMsg) {
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-danger fixed-top m-3';
        alertDiv.style.zIndex = '2000';
        alertDiv.innerText = errorMsg;
        document.body.prepend(alertDiv);
        setTimeout(() => alertDiv.remove(), 5000);
    }
</script>

<%- include('../partials/footer') %>